<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="WFP1/4/8">
        <title>Domochip WFP1/4/8</title>
        
        <link rel="stylesheet" href="pure-min.css">
        <link rel="stylesheet" href="side-menu.css">
    </head>
    <body>

        <div id="layout">
            <!-- Menu toggle -->
            <a href="#menu" id="menuLink" class="menu-link">
                <!-- Hamburger icon -->
                <span></span>
            </a>

            <div id="menu">
                <div class="pure-menu">
                    <div class="pure-menu-heading">Domochip</div>
                    <div class="pure-menu-heading">WFP1/4/8</div>

                    <ul class="pure-menu-list">
                        <li class="pure-menu-item"><a href="./" class="pure-menu-link">Status</a></li>
                        <li class="pure-menu-item pure-menu-selected"><a href="config" class="pure-menu-link">Config</a></li>
                        <li class="pure-menu-item"><a href="fw" class="pure-menu-link">Firmware</a></li>
                    </ul>
                </div>
            </div>

            <div id="main">
                <div class="header">
                    <h1>Configuration <span id="l1"><h6 style="display:inline"><b> Loading...</b></h6></span></h1>
                    <span id='i'></span><br>
                </div>

                <div class="content">
                    <form class="pure-form pure-form-aligned" id='f' style='display:none'>
                        <fieldset>
                            <div class="pure-control-group">
                                    <label for="name">SSID</label>
                                    <input type='text' id='s' name='s' maxlength='32' list="wnl">
                                    <select id="wnl"><option>Loading...</option></select>
                            </div>
                            <div class="pure-control-group">
                                <label for="name">Password</label>
                                <input type='password' id='p' name='p' maxlength='64'>
                            </div>
                            <div class="pure-control-group">
                                <label for="name">Hostname</label>
                                <input type='text' id='h' name='h' maxlength='24'>
                            </div>
                            <div class="pure-controls">
                                <input type='submit' value='Submit Config' class="pure-button pure-button-primary">
                            </div>
                        </fieldset>
                    </form>
                    <span id='r'></span>
                </div>
            </div>
        </div>
        <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
        <script>
            if (!window.jQuery){
                document.write('<script type="text/javascript" src="/jquery-3.2.1.min.js"><\/script>');
                document.getElementById('l').innerHTML='<h4 style="display:inline"> (JQuery loaded locally)</h4>';
            }
            else $("#l").fadeOut();
        </script>
        <script>
            if (!window.jQuery) {
                document.getElementById('l').innerHTML='';
                document.getElementById('l1').innerHTML='<h6 style="display:inline;color:red;"><b> Failed</b></h6>';
                document.getElementById('i').innerHTML='<h3 style="color:red"> JQuery is required. We were not able to load it :-(</h3>';
            }
        </script>
        <script>


            $("#f").submit(function(event){
                $("#r").html("Saving Configuration...");
                $.post("/sc",$("#f").serialize(),function(){ 
                    $("#f").hide();
                    var reload10sec=document.createElement('script');
                    reload10sec.text='var count=9;var cdi=setInterval(function(){$("#cd").text(count);if(!count){clearInterval(cdi);location.reload();}count--;},1000);';
                    $('#r').html('<h3><b>Configuration saved <span style="color: green;">successfully</span>. System is restarting now.</b></h3>This page will be reloaded in <span id="cd">10</span>sec.').append(reload10sec);
                });
                event.preventDefault();
            });

            $(document).ready(function(){
                $.getJSON("/gc", function(GC){

                    $("#s").val(GC.s);
                    $("#p").val(GC.p);
                    $("#h").val(GC.h);

                    $("#f").show();
                    
                    $.getJSON("/wnl", function(WNL){
                        $("#wnl").empty();
                        if(WNL.wnl.length==0) $("#wnl").append('<option>No Network Found</option>');
                        else{
                            $("#wnl").append('<option>Choose Your Network</option>');
                            $.each(WNL.wnl,function(k,v){
                                if($("#s").val()==v) $("#wnl").append('<option value="'+v+'" selected>'+v+'</option>');
                                else $("#wnl").append('<option value="'+v+'">'+v+'</option>');
                                });
                            $("#wnl").change(function(){$("#s").val($("#wnl").val())});
                        }
                    });

                    $("#l1").fadeOut();
                })
                .fail(function(){
                    $("#l1").html('<h6 style="display:inline;color:red;"><b> Failed</b></h6>');
                });
                
            });
        </script>

        <script src="side-menu.js"></script>

    </body>
</html>