<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="WFP1/4/8">
        <title>Domochip WirelessFilsPilotes</title>
        
        <link rel="stylesheet" href="pure-min.css" integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" crossorigin="anonymous">
        <link rel="stylesheet" href="side-menu.css">
    </head>
    <body>

        <div id="layout">
            <!-- Menu toggle -->
            <a href="#menu" id="menuLink" class="menu-link">
                <!-- Hamburger icon -->
                <span></span>
            </a>

            <div id="menu">
                <div class="pure-menu">
                    <div class="pure-menu-heading">Domochip</div>
                    <div class="pure-menu-heading">WFP1/4/8</div>

                    <ul class="pure-menu-list">
                        <li class="pure-menu-item pure-menu-selected"><a href="./" class="pure-menu-link">Status</a></li>
                        <li class="pure-menu-item"><a href="config" class="pure-menu-link">Config</a></li>
                        <li class="pure-menu-item"><a href="fw" class="pure-menu-link">Firmware</a></li>
                    </ul>
                </div>
            </div>

            <div id="main">
                <div class="header">
                    <h1>Status <span id="l"><h6 style="display:inline"><b> Loading...</b></h6></span></h1>
                    <span id='i'></span><br>
                </div>

                <div class="content">
                    <h2 class="content-subhead">System<span id="l1"><h6 style="display:inline"><b> Loading...</b></h6></span></h2>

                    SN : <span id="sn"></span><br>
                    Build version : <span id="b"></span><br>
                    UpTime : <span id="u"></span><br>
                    FreeHeap : <span id="f"></span><br>

                    <h2 class="content-subhead">WiFi<span id="l2"><h6 style="display:inline"><b> Loading...</b></h6></span></h2>
                    AP : <span id="ap"></span> (<span id="ai"></span>)<br>
                    Station : <span id="sta"></span> (<span id="stai"></span>)<br>

                            <h2 class="content-subhead">Fils Pilotes<span id="l3"><h6 style="display:inline"><b> Loading...</b></h6></span></h2>
        <span id="FPList"></span>
                    
                </div>
            </div>
        </div>

    
        <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
        <script>
            if (!window.jQuery){
                document.write('<script type="text/javascript" src="/jquery-3.2.1.min.js"><\/script>');
                document.getElementById('l').innerHTML='<h4 style="display:inline"> (JQuery loaded locally)</h4>';
            }
            else $("#l").fadeOut();
        </script>
        <script>
            if (!window.jQuery) {
                document.getElementById('l').innerHTML='';
                document.getElementById('l1').innerHTML='<h4 style="display:inline;color:red;"><b> Failed</b></h4>';
                document.getElementById('l2').innerHTML='<h4 style="display:inline;color:red;"><b> Failed</b></h4>';
                document.getElementById('i').innerHTML='<h3 style="color:red"> JQuery is required. We were not able to load it :-(</h3>';
            }
        </script>
        <script>
            $(document).ready(function(){
                $.getJSON("/gs0", function(GS0){

                    $.each(GS0,function(k,v){
                        $('#'+k).html(v);
                    })
                    $("#l1").fadeOut();
                })
                .fail(function(){
                    $("#l1").html('<h4 style="display:inline;color:red;"><b> Failed</b></h4>');
                });

                $.getJSON("/gsw", function(GSW){

                    $.each(GSW,function(k,v){
                        $('#'+k).html(v);
                    })
                    $("#l2").fadeOut();
                })
                .fail(function(){
                    $("#l2").html('<h4 style="display:inline;color:red;"><b> Failed</b></h4>');
                });

                        function generateFPButtons(fpNumber,currentValue){
            var ret='<div class="pure-button-group" role="group">';
            ret+='<style scoped>.pure-button-active{background: rgb(31, 141, 214);}</style>';
            ret+='<button id="FP'+fpNumber+'v51" class="pure-button'+(currentValue>50?' pure-button-active':'')+'">Confort</button>';
            ret+='<button id="FP'+fpNumber+'v41" class="pure-button'+(currentValue>40&&currentValue<51?' pure-button-active':'')+'">Confort-1</button>';
            ret+='<button id="FP'+fpNumber+'v31" class="pure-button'+(currentValue>30&&currentValue<41?' pure-button-active':'')+'">Confort-2</button>';
            ret+='<button id="FP'+fpNumber+'v21" class="pure-button'+(currentValue>20&&currentValue<31?' pure-button-active':'')+'">Eco</button>';
            ret+='<button id="FP'+fpNumber+'v11" class="pure-button'+(currentValue>10&&currentValue<21?' pure-button-active':'')+'">Hors Gel</button>';
            ret+='<button id="FP'+fpNumber+'v1" class="pure-button'+(currentValue<11?' pure-button-active':'')+'">ArrÃªt</button>';
            ret+='</div>';

            return ret;
        }

        function showCurrentFP(fpNumber,newValue){
            if(newValue<51) $("#FP"+fpNumber+"v51").removeClass("pure-button-active"); else $("#FP"+fpNumber+"v51").addClass("pure-button-active");
            if(newValue<41 || newValue>50) $("#FP"+fpNumber+"v41").removeClass("pure-button-active"); else $("#FP"+fpNumber+"v41").addClass("pure-button-active");
            if(newValue<31 || newValue>40) $("#FP"+fpNumber+"v31").removeClass("pure-button-active"); else $("#FP"+fpNumber+"v31").addClass("pure-button-active");
            if(newValue<21 || newValue>30) $("#FP"+fpNumber+"v21").removeClass("pure-button-active"); else $("#FP"+fpNumber+"v21").addClass("pure-button-active");
            if(newValue<11 || newValue>20) $("#FP"+fpNumber+"v11").removeClass("pure-button-active"); else $("#FP"+fpNumber+"v11").addClass("pure-button-active");
            if(newValue>10) $("#FP"+fpNumber+"v1").removeClass("pure-button-active"); else $("#FP"+fpNumber+"v1").addClass("pure-button-active");
        }

        function assignButtonsActions(fpNumber){

            $("#FP"+fpNumber+"v51").click(function(){$.get("/setFP?FP"+fpNumber+"=51",function(){showCurrentFP(fpNumber,51);})});
            $("#FP"+fpNumber+"v41").click(function(){$.get("/setFP?FP"+fpNumber+"=41",function(){showCurrentFP(fpNumber,41);})});
            $("#FP"+fpNumber+"v31").click(function(){$.get("/setFP?FP"+fpNumber+"=31",function(){showCurrentFP(fpNumber,31);})});
            $("#FP"+fpNumber+"v21").click(function(){$.get("/setFP?FP"+fpNumber+"=21",function(){showCurrentFP(fpNumber,21);})});
            $("#FP"+fpNumber+"v11").click(function(){$.get("/setFP?FP"+fpNumber+"=11",function(){showCurrentFP(fpNumber,11);})});
            $("#FP"+fpNumber+"v1").click(function(){$.get("/setFP?FP"+fpNumber+"=1",function(){showCurrentFP(fpNumber,1);})});
        }

        $.getJSON("/gs1", function(GS1){

            $.each(GS1,function(k,v){
                $('#FPList').append('FP'+k[2]+' : <b><span id="fp'+k[2]+'n"></span></b>'+ generateFPButtons(k[2],v) +'<br>');
                assignButtonsActions(k[2]);
            })
            $.getJSON("/gc1",function(GC1){
                $.each(GC1,function(k,v){
                    if(k.match(/fp[0-9]n/)) $('#'+k).text(v);
                })
            });
            $("#l3").fadeOut();
        })
        .fail(function(){
            $("#l3").html('<h4 style="display:inline;color:red;"><b> Failed</b></h4>');
        });
            });
        </script>
        <script src="side-menu.js"></script>
    </body>
</html>
