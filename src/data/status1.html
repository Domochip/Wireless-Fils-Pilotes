<div id="applicationName" style="display: none;">WirelessFilsPilotes</div>
<div id="shortApplicationName" style="display: none;">WFP1/4/8</div>

<h2 class="content-subhead">Fils Pilotes<span id="l"><h6 style="display:inline"><b> Loading...</b></h6></span></h2>
<span id="FPList"></span>
<h3 class="content-subhead">Home Automation Status</h3>
<span id="has1"></span><br>
<span id="has2"></span>

<script>
    //QuerySelector Prefix is added by load function to know into what element queySelector need to look for
    //var qsp = '#contentX ';

    function generateFPButtons(fpNumber,currentValue){
        var ret='<div class="pure-button-group" role="group">';
        ret+='<style scoped>.pure-button-active{background: rgb(31, 141, 214);}</style>';
        ret+='<button id="FP'+fpNumber+'v51" class="pure-button'+(currentValue>50?' pure-button-active':'')+'">Confort</button>';
        ret+='<button id="FP'+fpNumber+'v41" class="pure-button'+(currentValue>40&&currentValue<51?' pure-button-active':'')+'">Confort-1</button>';
        ret+='<button id="FP'+fpNumber+'v31" class="pure-button'+(currentValue>30&&currentValue<41?' pure-button-active':'')+'">Confort-2</button>';
        ret+='<button id="FP'+fpNumber+'v21" class="pure-button'+(currentValue>20&&currentValue<31?' pure-button-active':'')+'">Eco</button>';
        ret+='<button id="FP'+fpNumber+'v11" class="pure-button'+(currentValue>10&&currentValue<21?' pure-button-active':'')+'">Hors Gel</button>';
        ret+='<button id="FP'+fpNumber+'v1" class="pure-button'+(currentValue<11?' pure-button-active':'')+'">ArrÃªt</button>';
        ret+='</div>';

        return ret;
    }

    function showCurrentFP(fpNumber,newValue){
        if(newValue<51) $(qsp+"#FP"+fpNumber+"v51").classList.remove("pure-button-active"); else $(qsp+"#FP"+fpNumber+"v51").classList.add("pure-button-active");
        if(newValue<41 || newValue>50) $(qsp+"#FP"+fpNumber+"v41").classList.remove("pure-button-active"); else $(qsp+"#FP"+fpNumber+"v41").classList.add("pure-button-active");
        if(newValue<31 || newValue>40) $(qsp+"#FP"+fpNumber+"v31").classList.remove("pure-button-active"); else $(qsp+"#FP"+fpNumber+"v31").classList.add("pure-button-active");
        if(newValue<21 || newValue>30) $(qsp+"#FP"+fpNumber+"v21").classList.remove("pure-button-active"); else $(qsp+"#FP"+fpNumber+"v21").classList.add("pure-button-active");
        if(newValue<11 || newValue>20) $(qsp+"#FP"+fpNumber+"v11").classList.remove("pure-button-active"); else $(qsp+"#FP"+fpNumber+"v11").classList.add("pure-button-active");
        if(newValue>10) $(qsp+"#FP"+fpNumber+"v1").classList.remove("pure-button-active"); else $(qsp+"#FP"+fpNumber+"v1").classList.add("pure-button-active");
    }

    $(qsp+"#FPList").addEventListener('click',function(evt){
        var res;
        if(res=evt.srcElement.id.match(/FP([1-8])v([0-9]{1,2})/)){
            get('/setFP?FP'+res[1]+'='+res[2],
                function(){
                    showCurrentFP(res[1],res[2]);
                }
            );
        }
    });

    getJSON("/gs"+qsp[8],
        function(GS){
            for(k in GS){
                if(k.match(/FP[1-8]/)){
                    $(qsp+'#FPList').innerHTML+=k+' : <b><span id="fp'+k[2]+'n"></span></b>'+ generateFPButtons(k[2],GS[k]) +'<br>';
                }
                else{
                    if((e = $(qsp+'#'+k)) != undefined) e.innerHTML = GS[k];
                }
            }

            getJSON("/gc"+qsp[8],
                function(GC){
                    for(k in GC){
                        if(k.match(/fp[0-9]n/)) $(qsp+'#'+k).innerText=GC[k];
                    }
                }
            );

            fadeOut($(qsp+"#l"));
        },
        function(){
            $(qsp+"#l").innerHTML='<h4 style="display:inline;color:red;"><b> Failed</b></h4>';
        }
    );
</script>